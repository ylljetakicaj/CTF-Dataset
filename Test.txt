using System;
using System.IO;
using System.Text.RegularExpressions;
using System.Threading.Tasks;

class Program
{
    static void Main(string[] args)
    {
        Run().Wait();
    }

    static async Task Run()
    {
        string rootPath = @"C:\Clients";
        string apiBaseUrl = "https://your-indoc-edge-api.com";
        string username = "yourUser";
        string password = "yourPass";

        InDocClient client = new InDocClient(apiBaseUrl, username, password);

        foreach (string clientFolder in Directory.GetDirectories(rootPath))
        {
            string clientId = Path.GetFileName(clientFolder);
            string[] files = Directory.GetFiles(clientFolder);

            foreach (string file in files)
            {
                var tuple = ExtractNameSurname(file);
                string name = tuple.Item1;
                string surname = tuple.Item2;

                Console.WriteLine("Processing " + clientId + ": " + name + " " + surname);

                string folderId = await client.CreateCaseFolderAsync(clientId, name, surname);

                if (folderId == null)
                {
                    Console.WriteLine("❌ Failed to create folder");
                    continue;
                }

                bool ok = await client.UploadDocumentAsync(folderId, file);

                Console.WriteLine(ok ? "✔ Uploaded" : "❌ Upload failed");
            }
        }

        Console.WriteLine("DONE");
    }

    static Tuple<string, string> ExtractNameSurname(string path)
    {
        string file = Path.GetFileNameWithoutExtension(path);

        Match m = Regex.Match(file, @"^\d+_([A-Za-z]+)_([A-Za-z]+)_");

        if (m.Success)
            return Tuple.Create(m.Groups[1].Value, m.Groups[2].Value);

        return Tuple.Create("Unknown", "Unknown");
    }
}